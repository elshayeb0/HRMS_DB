@{
    ViewData["Title"] = "Assign Mission to Employee";
}
<h1><i class="fas fa-plane-departure"></i> Assign Mission to Employee</h1>
<hr />

@* Display Status Messages *@
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" id="successAlert" role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" id="errorAlert" role="alert">
        @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<div class="card">
    <div class="card-body">
        <form method="post" asp-controller="HR" asp-action="AssignMission" id="assignMissionForm">
            <div class="form-group">
                <label for="employeeId">Select Employee <span class="text-danger">*</span></label>
                <select class="form-control" id="employeeId" name="employeeId" required>
                    <option value="">-- Select Employee --</option>
                    @foreach (var employee in ViewBag.Employees)
                    {
                        <option value="@employee.EmployeeId">@employee.FullName</option>
                    }
                </select>
            </div>
            <div class="form-group">
                <label for="destination">Destination <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="destination" name="destination" placeholder="e.g., Paris, France" required />
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="startDate">Start Date <span class="text-danger">*</span></label>
                    <input type="date" class="form-control" id="startDate" name="startDate" required />
                </div>
                <div class="form-group col-md-6">
                    <label for="endDate">End Date <span class="text-danger">*</span></label>
                    <input type="date" class="form-control" id="endDate" name="endDate" required />
                </div>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-check"></i> Assign Mission
            </button>
            <a href="/" class="btn btn-secondary">Cancel</a>
        </form>
    </div>
</div>

<script>
    // Auto-hide success and error messages after specified time
    document.addEventListener('DOMContentLoaded', function () {
        const successAlert = document.getElementById('successAlert');
        const errorAlert = document.getElementById('errorAlert');

        if (successAlert) {
            setTimeout(function () {
                // Use Bootstrap 5 alert close method
                const alert = new bootstrap.Alert(successAlert);
                alert.close();
            }, 4000); // 4 seconds for success
        }

        if (errorAlert) {
            setTimeout(function () {
                // Use Bootstrap 5 alert close method
                const alert = new bootstrap.Alert(errorAlert);
                alert.close();
            }, 8000); // 8 seconds for error (longer so user can read)
        }

        // Handle manual close button click
        const closeButtons = document.querySelectorAll('.btn-close');
        closeButtons.forEach(button => {
            button.addEventListener('click', function (e) {
                const alert = this.closest('.alert');
                if (alert) {
                    const bootstrapAlert = new bootstrap.Alert(alert);
                    bootstrapAlert.close();
                }
            });
        });
    });

    // Client-side date validation
    document.getElementById('assignMissionForm').addEventListener('submit', function (e) {
        const startDate = new Date(document.getElementById('startDate').value);
        const endDate = new Date(document.getElementById('endDate').value);

        if (endDate < startDate) {
            e.preventDefault();
            alert('End date cannot be before the start date. Please select valid dates.');
            return false;
        }
    });
</script>